<aura:component controller="PropertyController" implements="flexipage:availableForRecordHome,force:hasRecordId">
    <aura:attribute name="property" type="Property__c" />
    <aura:attribute name="visits" type="Property_Visit__c[]" />
    <aura:attribute name="offers" type="Offer__c[]" />
    <aura:attribute name="loading" type="Boolean" default="true" />
    <aura:attribute name="error" type="String" />
    
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    <aura:handler name="change" value="{!v.recordId}" action="{!c.recordIdChanged}" />
    
    <div class="property-detail-container">
        <aura:if isTrue="{!v.loading}">
            <div class="loading-container">
                <lightning-spinner alternativeText="Loading" size="large"></lightning-spinner>
                <p>Loading property details...</p>
            </div>
        </aura:if>
        
        <aura:if isTrue="{!not(empty(v.error))}">
            <div class="error-container">
                <lightning-icon iconName="utility:error" size="small"></lightning-icon>
                <span class="error-message">{!v.error}</span>
            </div>
        </aura:if>
        
        <aura:if isTrue="{!and(not(v.loading), empty(v.error))}">
            <div class="property-header">
                <h1 class="property-title">{!v.property.Name}</h1>
                <lightning-button
                    label="Edit"
                    onclick="{!c.handleEdit}"
                    variant="neutral"
                ></lightning-button>
            </div>
            
            <div class="property-content">
                <div class="property-info">
                    <div class="info-section">
                        <h3>Property Details</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Address:</span>
                                <span class="info-value">{!v.property.Address__c}, {!v.property.City__c}, {!v.property.State__c} {!v.property.Zip_Code__c}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Price:</span>
                                <span class="info-value">{!'$' + v.property.Price__c}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Bedrooms/Bathrooms:</span>
                                <span class="info-value">{!v.property.Bedrooms__c} BD / {!v.property.Bathrooms__c} BA</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Square Feet:</span>
                                <span class="info-value">{!v.property.Square_Feet__c}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Property Type:</span>
                                <span class="info-value">{!v.property.Property_Type__c}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Status:</span>
                                <span class="info-value status-{!v.property.Status__c.toLowerCase()}">{!v.property.Status__c}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Listing Date:</span>
                                <span class="info-value">{!v.property.Listing_Date__c}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="visits-section">
                        <h3>Property Visits</h3>
                        <c:visitList visits="{!v.visits}" />
                    </div>
                    
                    <div class="offers-section">
                        <h3>Offers</h3>
                        <c:offerList offers="{!v.offers}" />
                    </div>
                </div>
            </div>
        </aura:if>
    </div>
</aura:component>